<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DJ Marcel - Gestion des Playlists</title>
<style>
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    padding: 20px;
    color: #333;
}
.container {
    max-width: 1200px;
    margin: 0 auto;
}
header {
    text-align: center;
    color: white;
    margin-bottom: 40px;
}
header h1 { font-size: 2.5em; text-shadow: 2px 2px 5px rgba(0,0,0,0.3); }
header p { opacity: 0.9; }

.nav-links {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-bottom: 30px;
}
.nav-links a {
    color: white;
    text-decoration: none;
    background: rgba(255,255,255,0.2);
    padding: 10px 20px;
    border-radius: 20px;
    transition: all 0.3s;
}
.nav-links a:hover { background: rgba(255,255,255,0.4); }
.nav-links a.active { background: rgba(255,255,255,0.4); font-weight: bold; }

.card {
    background: white;
    border-radius: 10px;
    padding: 30px;
    margin-bottom: 30px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
}
.card h2 { color: #764ba2; margin-bottom: 20px; }

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}
.section-header h3 { margin: 0; }

.playlist-section {
    border-top: 1px solid #ddd;
    padding-top: 15px;
    margin-top: 15px;
}
.playlist-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.songs-list {
    max-height: 200px;
    overflow-y: auto;
    margin-top: 10px;
}
.song-item {
    display: flex;
    justify-content: space-between;
    padding: 8px;
    background: #f0f0f0;
    margin-bottom: 5px;
    border-radius: 5px;
}
.song-item button {
    background: #e74c3c;
    color: white;
    border: none;
    padding: 4px 8px;
    border-radius: 3px;
    cursor: pointer;
}
.song-item button:hover { background: #c0392b; }

.add-song-form {
    display: flex;
    gap: 10px;
    margin-top: 10px;
}
.add-song-form input {
    flex: 1;
    padding: 8px;
    border-radius: 5px;
    border: 1px solid #ddd;
}
.add-song-form button {
    padding: 8px 12px;
    border: none;
    border-radius: 5px;
    background: #28a745;
    color: white;
    cursor: pointer;
}
.add-song-form button:hover { background: #218838; }

.message {
    padding: 10px;
    border-radius: 5px;
    margin-bottom: 20px;
    display: none;
}
.message.success { background: #d4edda; color: #155724; }
.message.error { background: #f8d7da; color: #721c24; }

.footer {
    text-align: center;
    color: white;
    opacity: 0.8;
    margin-top: 40px;
}

.btn {
    padding: 6px 12px;
    border-radius: 5px;
    cursor: pointer;
    border: none;
    color: white;
}
.btn-primary { background: #764ba2; }
.btn-primary:hover { background: #5a3580; }
.btn-danger { background: #e74c3c; }
.btn-danger:hover { background: #c0392b; }

.card input, .card select {
    padding: 8px;
    border-radius: 5px;
    border: 1px solid #ddd;
}
</style>
</head>
<body>
<div class="container">
<header>
    <h1>üéß DJ Marcel - Espace DJ</h1>
    <p>G√©rez vos playlists et soir√©es</p>
</header>

<div class="nav-links">
  <a href="/admin.html">üéß Espace Admin</a>
  <a href="/dj.html" class="active">üéõÔ∏è Espace DJ</a>
  <a href="/">üè† Accueil</a>
</div>

<div class="card">
<h2>Gestion des Playlists</h2>

<div style="margin-bottom:20px;">
    <input type="text" id="newPlaylistName" placeholder="Nom nouvelle playlist">
    <button class="btn btn-primary" onclick="createPlaylist()">‚ûï Cr√©er Playlist</button>
</div>

<div id="playlistsContainer"></div>

<div id="message" class="message"></div>
</div>

<div class="footer">
<p>üíø DJ Marcel POC - Gestion des Playlists</p>
</div>
</div>

<script>
let playlists = [];
let soirees = [];

async function loadData() {
    [playlists, soirees] = await Promise.all([
        (await fetch('/api/playlists')).json(),
        (await fetch('/api/soirees')).json()
    ]);
    displayPlaylists();
}

function displayPlaylists() {
    const container = document.getElementById('playlistsContainer');
    container.innerHTML = '';
    playlists.forEach(pl => {
        const div = document.createElement('div');
        div.className = 'playlist-section';
        const songsHTML = pl.songs.map((s,i)=>`
            <div class="song-item">
                <span>${i+1}. ${s}</span>
                <button onclick="removeSong(${pl.id}, ${i})">‚úï</button>
            </div>`).join('');
        const attachOptions = soirees.map(s=>`
            <option value="${s.id}" ${s.playlistIds.includes(pl.id)?'selected':''}>${s.name} - ${s.date}</option>
        `).join('');
        div.innerHTML = `
            <div class="playlist-header">
                <strong>${pl.name}</strong>
                <button class="btn btn-danger" onclick="deletePlaylist(${pl.id})">Supprimer</button>
            </div>
            <div class="add-song-form">
                <input type="text" id="newSong-${pl.id}" placeholder="Ajouter une chanson...">
                <button onclick="addSong(${pl.id})">‚ûï Ajouter</button>
            </div>
            <div class="songs-list">${songsHTML || '<p style="color:#999">Aucune chanson</p>'}</div>
            <label>Associer √† des soir√©es:</label>
            <select multiple onchange="attachToSoiree(${pl.id}, this)">
                ${attachOptions}
            </select>
        `;
        container.appendChild(div);
    });
}

async function createPlaylist() {
    const name = document.getElementById('newPlaylistName').value.trim();
    if(!name) return showMessage('Nom requis','error');
    const res = await fetch('/api/playlists', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({name})
    });
    if(res.ok){ showMessage('Playlist cr√©√©e!','success'); document.getElementById('newPlaylistName').value=''; loadData();}
}

async function deletePlaylist(id){
    // Pour le POC, suppression locale
    playlists = playlists.filter(p=>p.id!==id);
    showMessage('Playlist supprim√©e','success');
    loadData();
}

async function addSong(playlistId){
    const input = document.getElementById(`newSong-${playlistId}`);
    const song = input.value.trim();
    if(!song) return;
    await fetch(`/api/playlists/${playlistId}/songs`, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({song})
    });
    input.value='';
    showMessage('Chanson ajout√©e','success');
    loadData();
}

async function removeSong(playlistId, index){
    await fetch(`/api/playlists/${playlistId}/songs/${index}`, {method:'DELETE'});
    showMessage('Chanson supprim√©e','success');
    loadData();
}

async function attachToSoiree(playlistId, select){
    const selectedIds = [...select.selectedOptions].map(o=>parseInt(o.value));
    // Supprime de toutes les soir√©es d'abord
    for(let s of soirees){
        if(s.playlistIds.includes(playlistId) && !selectedIds.includes(s.id)){
            s.playlistIds = s.playlistIds.filter(pid=>pid!==playlistId);
        }
    }
    // Ajoute aux s√©lectionn√©es
    for(let sid of selectedIds){
        await fetch(`/api/soirees/${sid}/playlists`, {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({playlistId})
        });
    }
    loadData();
}

function showMessage(text,type){
    const div = document.getElementById('message');
    div.textContent=text;
    div.className=`message ${type}`;
    div.style.display='block';
    setTimeout(()=>{div.style.display='none';},3000);
}

loadData();
</script>
</body>
</html>
